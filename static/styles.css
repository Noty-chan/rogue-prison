:root{
  --bg0:#0b0b10;
  --bg1:#11111a;
  --panel:#141421;
  --panel2:#1a1a2b;
  --ink:#e7e7ff;
  --muted:#9aa0c8;
  --accent:#8b5cf6;
  --accent2:#22c55e;
  --danger:#ef4444;
  --gold:#fbbf24;
  --border:#2b2b44;
  --shadow: rgba(0,0,0,.35);
  --pixel: 2px;
  --radius: 14px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  color:var(--ink);
  background:
    radial-gradient(1200px 800px at 20% 10%, rgba(139,92,246,.12), transparent 60%),
    radial-gradient(1000px 700px at 80% 20%, rgba(34,197,94,.08), transparent 55%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
  font-family: "VT323", ui-monospace, monospace;
  font-size: 20px;
  overflow-y: auto;
  overflow-x:hidden;
  scrollbar-gutter: stable;
}

/* Системные скроллбары делаем темнее, чтобы не появлялась светлая полоса сбоку */
body::-webkit-scrollbar{width:12px}
body::-webkit-scrollbar-track{background: linear-gradient(180deg, var(--bg0), var(--bg1))}
body::-webkit-scrollbar-thumb{
  background: rgba(139,92,246,.35);
  border: 2px solid rgba(10,10,16,.85);
  border-radius: 12px;
}
body::-webkit-scrollbar-thumb:hover{background: rgba(139,92,246,.55)}

/* scanlines */
body:before{
  content:"";
  position:fixed; inset:0;
  pointer-events:none;
  background: repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.03),
    rgba(255,255,255,0.03) 1px,
    transparent 1px,
    transparent 4px
  );
  mix-blend-mode: overlay;
  opacity:.25;
}

.app{min-height:100%; display:flex; flex-direction:column}

.topbar{
  display:flex;
  gap:16px;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(180deg, rgba(20,20,33,.92), rgba(12,12,18,.86));
  position:sticky; top:0; z-index:20;
  backdrop-filter: blur(6px);
}

.brand{display:flex; align-items:center; gap:12px}
.logo{
  width:42px;height:42px;
  display:grid;place-items:center;
  background: linear-gradient(180deg, var(--panel2), var(--panel));
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow: 0 10px 24px var(--shadow);
}
.title .t1{font-family:"Press Start 2P"; font-size:12px; letter-spacing:.5px}
.title .t2{font-size:18px; color:var(--muted); margin-top:6px}

.hud{display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
.hudItem{
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:999px;
  background: rgba(20,20,33,.55);
}
.hudItem.hp{border-color: rgba(239,68,68,.35)}
.hudItem.mana{border-color: rgba(139,92,246,.35)}
.hudItem.gold{border-color: rgba(251,191,36,.35)}

.nav{display:flex; gap:10px}
.btn{
  cursor:pointer;
  border:1px solid var(--border);
  background: linear-gradient(180deg, rgba(34,34,55,.95), rgba(18,18,28,.95));
  color:var(--ink);
  padding:10px 12px;
  border-radius:12px;
  font-family:"Press Start 2P";
  font-size:11px;
  box-shadow: 0 10px 24px var(--shadow);
  transition: transform .12s ease, filter .12s ease, border-color .12s ease;
}
.btn:hover{transform: translateY(-1px); filter: brightness(1.06)}
.btn:active{transform: translateY(0px) scale(.99)}
.btnPrimary{
  background: linear-gradient(180deg, rgba(139,92,246,.95), rgba(99,102,241,.9));
  border-color: rgba(139,92,246,.8);
}
.btnGhost{
  background: rgba(20,20,33,.35);
}
.input{
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--border);
  background: rgba(10,10,16,.55);
  color:var(--ink);
  font-family:"VT323";
  font-size:20px;
}
.chip{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid var(--border);
  background: rgba(20,20,33,.55);
}

.toast{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  top:72px;
  padding:10px 14px;
  border:1px solid rgba(139,92,246,.45);
  background: rgba(12,12,18,.88);
  border-radius:999px;
  z-index:50;
  box-shadow: 0 16px 50px var(--shadow);
  opacity:0;
  transition: opacity .18s ease, transform .18s ease;
}
.toast.show{opacity:1; transform:translateX(-50%) translateY(4px)}
.hidden{display:none !important}

.overlay{
  position:fixed; inset:0;
  background: rgba(0,0,0,.62);
  z-index:40;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:28px 18px 22px;
  overflow:auto;
}
.panel{
  width: min(820px, 92vw);
  max-height: 90vh;
  background: linear-gradient(180deg, rgba(26,26,43,.96), rgba(15,15,25,.96));
  border:1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: 0 30px 90px rgba(0,0,0,.55);
  padding:18px 18px 14px;
  overflow:auto;
  margin-inline:auto;
}
.panel.wide{width:min(1080px, 94vw)}
.panel h1,.panel h2,.panel h3{
  font-family:"Press Start 2P";
  font-weight:800;
  margin: 6px 0 10px;
}
.panel h1{font-size:16px}
.panel h2{font-size:14px}
.panel h3{font-size:12px}
.muted{color:var(--muted)}
.tiny{font-size:16px}
.hr{height:1px; background: var(--border); margin:12px 0}
.grid2{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
.row{display:flex; gap:10px; align-items:center}
.row.wrap{flex-wrap:wrap}
.rowEnd{display:flex; gap:10px; justify-content:flex-end; align-items:center}
.spacer{flex:1}

.screen{
  padding: 18px 16px 24px;
  width: min(1200px, 96vw);
  margin: 0 auto;
}
.screenHeader{margin-bottom:10px}
.mapProgress{display:flex; gap:8px; flex-wrap:wrap; margin: 14px 0 12px;}
.floorDot{width: 18px; height: 18px; border-radius: 6px; border:1px solid var(--border); background: rgba(20,20,33,.65); box-shadow: 0 10px 24px var(--shadow);}
.floorDot.on{background: rgba(139,92,246,.55); border-color: rgba(139,92,246,.8)}
.floorDot.boss{background: rgba(239,68,68,.25); border-color: rgba(239,68,68,.7)}
.mapGraph{
  position:relative;
  min-height: 460px;
  border:1px solid var(--border);
  border-radius: var(--radius);
  background: radial-gradient(circle at 50% 20%, rgba(139,92,246,.05), transparent 42%), rgba(12,12,18,.5);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.02), 0 18px 50px var(--shadow);
  overflow:hidden;
}
.mapLinks{position:absolute; inset:0; width:100%; height:100%; z-index:1;}
.mapColumns{position:absolute; inset:0; z-index:2;}
.mapNode{
  position:absolute;
  transform: translate(-50%, -50%);
  min-width: 110px;
  max-width: 160px;
  padding:10px 12px 8px;
  border:1px solid var(--border);
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(26,26,43,.9), rgba(12,12,18,.88));
  box-shadow: 0 12px 32px var(--shadow);
  transition: transform .12s ease, filter .12s ease, border-color .12s ease, box-shadow .12s ease;
}
.mapNode .nodeLabel{font-family:"Press Start 2P"; font-size:11px; margin-bottom:4px}
.mapNode .nodeHint{color:var(--muted); font-size:16px; line-height:1.2}
.mapNode .nodeFloor{margin-top:6px; font-size:15px; color:var(--muted)}
.mapNode.reachable{cursor:pointer; border-color: rgba(139,92,246,.55); box-shadow: 0 14px 40px rgba(139,92,246,.25);}
.mapNode.reachable:hover{transform: translate(-50%, -52%) scale(1.02); filter: brightness(1.06)}
.mapNode.visited{border-color: rgba(34,197,94,.5); box-shadow: 0 12px 32px rgba(34,197,94,.22);}
.mapNode.current{outline: 2px solid rgba(139,92,246,.65); outline-offset: 3px;}
.mapNode.locked{opacity:.55}
.mapNode.boss{border-color: rgba(239,68,68,.6); box-shadow: 0 14px 36px rgba(239,68,68,.28);}
.mapEdge{stroke: rgba(99,102,241,.35); stroke-width: 3; stroke-linecap: round;}
.mapEdge.visited{stroke: rgba(34,197,94,.7);}
.mapEdge.active{stroke: rgba(139,92,246,.9);}
.roomChoices{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:10px;
}
.roomBtn{
  padding:14px 14px 12px;
  border:1px solid var(--border);
  border-radius: var(--radius);
  background: linear-gradient(180deg, rgba(26,26,43,.85), rgba(14,14,22,.85));
  box-shadow: 0 18px 50px var(--shadow);
  cursor:pointer;
  transition: transform .12s ease, filter .12s ease, border-color .12s ease;
}
.roomBtn:hover{transform: translateY(-2px); filter: brightness(1.06); border-color: rgba(139,92,246,.45)}
.roomBtn .label{font-family:"Press Start 2P"; font-size:12px}
.roomBtn .hint{margin-top:8px; color:var(--muted); font-size:18px}

/* Combat */
.arena{
  display:flex;
  flex-direction:column;
  gap:12px;
  padding-bottom: 140px;
}
.enemyRow{
  display:flex;
  gap:12px;
  justify-content:center;
  flex-wrap:wrap;
}
.entity{ 
  width: min(320px, 90vw);
  background: linear-gradient(180deg, rgba(26,26,43,.92), rgba(13,13,22,.88));
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:12px 12px 10px;
  box-shadow: 0 18px 50px var(--shadow);
  position:relative;
}
.entity.enemy{cursor:default}
.entity.enemy.dropTarget{outline: 2px dashed rgba(139,92,246,.65); outline-offset: 4px}
.entity.enemy.targetable{box-shadow: 0 0 0 2px rgba(139,92,246,.25), 0 0 30px rgba(139,92,246,.2);}
.entityName{
  display:flex;
  justify-content:space-between;
  align-items:baseline;
  font-family:"Press Start 2P";
  font-size:11px;
}
.entitySub{
  margin-top:8px;
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:wrap;
}
.intent{
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(139,92,246,.35);
  background: rgba(139,92,246,.12);
  color: var(--ink);
}
.intent b{font-family:"Press Start 2P"; font-size:10px}
.bars{display:grid; gap:6px; margin-top:10px}
.bar{
  border:1px solid var(--border);
  border-radius:10px;
  padding:6px 10px;
  background: rgba(10,10,16,.45);
}
.bar.hp{border-color: rgba(239,68,68,.35)}
.bar.mana{border-color: rgba(139,92,246,.35)}
.statusRow{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
.status{
  padding:6px 10px;
  border:1px solid var(--border);
  border-radius:999px;
  background: rgba(20,20,33,.55);
  color: var(--ink);
}
.status .k{font-family:"Press Start 2P"; font-size:10px; margin-right:6px}
.battlefield{
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap:12px;
  align-items:center;
  margin-top:6px;
}
.entity.player{justify-self:start}
.centerSigil{justify-self:center; text-align:center; opacity:.9}
.centerSigil .sigil{
  font-size:40px;
  text-shadow: 0 0 16px rgba(139,92,246,.35);
  animation: pulse 2.4s ease-in-out infinite;
}
@keyframes pulse{
  0%,100%{transform: scale(1); opacity:.85}
  50%{transform: scale(1.06); opacity:1}
}
.pilePanel{justify-self:end; display:grid; gap:10px}
.pile{
  padding:10px 12px;
  border-radius: var(--radius);
  border:1px solid var(--border);
  background: rgba(20,20,33,.55);
  min-width: 160px;
}

.combatFooter{
  display:flex;
  gap:12px;
  align-items:stretch;
}
.logBox{
  flex:1;
  border:1px solid var(--border);
  background: rgba(10,10,16,.45);
  border-radius: var(--radius);
  padding:10px 12px;
  max-height: 160px;
  overflow:auto;
}
.actions{display:flex; align-items:center}

/* Hand + cards */
.hand{
  position:fixed;
  left:50%;
  transform: translateX(-50%);
  bottom: 14px;
  width: min(1200px, 96vw);
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  z-index:30;
  pointer-events:none; /* разрешим клики через карточки (мы будем включать pointer-events на них) */
}
.card{
  width: 190px;
  border-radius: 14px;
  border:1px solid var(--border);
  background: linear-gradient(180deg, rgba(26,26,43,.95), rgba(12,12,18,.92));
  box-shadow: 0 18px 50px var(--shadow);
  padding:10px 10px 9px;
  pointer-events:auto;
  cursor:grab;
  user-select:none;
  transition: transform .12s ease, filter .12s ease, border-color .12s ease;
  position:relative;
}
.card:hover{transform: translateY(-3px); filter: brightness(1.06); border-color: rgba(139,92,246,.5)}
.card:active{cursor:grabbing; transform: translateY(-1px) scale(.99)}
.card.dragging{
  position:fixed;
  z-index:80;
  transform: translate(-50%, -50%) scale(1.02);
  filter: brightness(1.1);
  pointer-events:none;
}
.card .top{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:8px;
}
.card .name{
  font-family:"Press Start 2P";
  font-size:10px;
  line-height: 1.35;
}
.card .cost{
  width: 36px; height: 36px;
  border-radius: 12px;
  border:1px solid rgba(139,92,246,.5);
  background: rgba(139,92,246,.16);
  display:grid;
  place-items:center;
  font-family:"Press Start 2P";
  font-size:12px;
}
.card .desc{margin-top:10px; color:var(--muted); line-height:1.25}
.card .tags{margin-top:10px; display:flex; gap:6px; flex-wrap:wrap}
.card.noMana{cursor:not-allowed; filter: grayscale(.3) brightness(.9); border-color: rgba(239,68,68,.45); box-shadow: 0 12px 32px rgba(239,68,68,.15);}
.tag{
  padding:4px 8px;
  border-radius:999px;
  border:1px solid var(--border);
  background: rgba(20,20,33,.55);
  font-size:16px;
}
.rarity-common{border-color: rgba(148,163,184,.35)}
.rarity-uncommon{border-color: rgba(34,197,94,.55)}
.rarity-rare{border-color: rgba(59,130,246,.55)}
.rarity-legendary{border-color: rgba(251,191,36,.65)}
.type-upgrade .cost{border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.12)}
.type-defense .cost{border-color: rgba(59,130,246,.45); background: rgba(59,130,246,.12)}
.type-attack .cost{border-color: rgba(239,68,68,.45); background: rgba(239,68,68,.12)}

/* Reward lists */
.rewardChoices{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap:10px;
  width:100%;
}
.cardBtn{
  cursor:pointer;
}
.cardBtn .card{pointer-events:none}
.cardBtn:hover .card{transform: translateY(-3px); filter: brightness(1.06)}
/* Codex */
.codexList{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap:10px;
  margin-top:12px;
}
.deckList{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:10px;
  margin-top:12px;
}
.inheritSlots{
  display:grid;
  grid-template-columns: 1fr;
  gap:14px;
  margin-top:10px;
}
.inheritSlot{
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:12px;
  background: rgba(10,10,16,.35);
}
.inheritSlot .slotTitle{
  font-family:"Press Start 2P";
  font-size:11px;
  margin-bottom:10px;
}
.inheritSlot .options{
  display:grid;
  grid-template-columns: repeat(5, 1fr);
  gap:10px;
}
.selectedGlow{
  outline: 2px solid rgba(34,197,94,.7);
  outline-offset: 4px;
}

.cardTooltip{
  position:fixed;
  z-index:90;
  max-width: 280px;
  padding:12px 12px 10px;
  border:1px solid var(--border);
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(26,26,43,.95), rgba(12,12,18,.94));
  box-shadow: 0 18px 50px var(--shadow);
  pointer-events:none;
  font-size:18px;
}
.cardTooltip .title{font-family:"Press Start 2P"; font-size:12px; margin-bottom:6px}
.cardTooltip .section{margin-top:6px; color:var(--muted); line-height:1.25}
.cardTooltip .section strong{color:var(--ink); font-size:19px}

/* responsive */
@media (max-width: 980px){
  .grid2{grid-template-columns: 1fr}
  .battlefield{grid-template-columns: 1fr; justify-items:stretch}
  .pilePanel{grid-template-columns: repeat(3, 1fr); justify-self:stretch}
  .roomChoices{grid-template-columns: 1fr}
  .rewardChoices{grid-template-columns: 1fr}
  .codexList{grid-template-columns: 1fr}
  .deckList{grid-template-columns: 1fr 1fr}
  .inheritSlot .options{grid-template-columns: 1fr 1fr}
}
