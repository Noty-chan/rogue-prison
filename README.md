# Magic Prison Roguelike (локально, Python + браузер)

Мини-проект: карточный рогалик в стиле псевдо-пиксель / Slay the Spire, с:
- 3 актами на 10 этажей (4/8/10 — боссы), и возможностью «петли» после победы
- Бой 1 против 1–3, телеграф намерений
- Мана, рука до 6, сброс/тасовка, крит 15% у всех атак
- Типы карт: атака/защита/навык/апгрейд (апгрейды «изгнание» и баф на бой)
- 4 редкости, пул 20/15/10/5
- Билд-теги: заряд, яд, ожог, кровоток, контроль, сброс, бурст, крит, блок, мана…

## Запуск

```bash
python -m venv .venv
# Windows: .venv\Scripts\activate
source .venv/bin/activate

pip install -r requirements.txt
python server.py
```

Открой в браузере: `http://127.0.0.1:5173`

### Локальная сеть и резервный API
- Для доступа с других устройств в одной сети запусти сервер с `MPRL_HOST=0.0.0.0`:
  ```bash
  MPRL_HOST=0.0.0.0 python server.py
  ```
  Затем в настройках можно выбрать LAN-адрес из списка или вручную указать `http://<ip>:5173`.
- В настройках есть поле «Резервная база API» — если основной адрес не отвечает, фронт автоматически переключится.

### GitHub Pages / внешний хостинг
- Фронт работает как статический: все запросы идут по относительному пути `api/*`. Это позволяет открыть игру с `https://<user>.github.io/rogue-prison/`.
- Если API живёт на другом домене, укажи базу в настройках (поле «База API») — адрес сохранится в localStorage.
- Сид (`mprl_sid`) и выбранная база API живут в `localStorage`, поэтому прогресс подтянется после перезагрузки страницы даже на Pages.

## Управление
- Перетаскивай карты на врагов (или просто в поле, если цель не нужна).
- Space — конец хода.
- Меню/Колода/Энциклопедия — сверху.

## Архитектура (до 10 файлов)
- `server.py` — Flask: отдаёт фронт + API `/api/action`
- `game.py` — логика: забег, генерация комнат, бой, награды, мета-наследие, акт-энды
- `content.py` — данные: 50 карт, статусы, бафы, враги, события
- `static/index.html` — разметка UI/экранов
- `static/styles.css` — псевдо-пиксель стили + минималистичные анимации
- `static/app.js` — рендер из state + перетаскивание + отправка действий
- `requirements.txt` — зависимости

## Как расширять
- Добавить карты: `content.py -> CARDS` (описывай `effects` DSL)
- Добавить врагов/боссов: `content.py -> ENEMIES/ELITES/BOSSES`
- Добавить события: `content.py -> EVENTS`
- Добавить новый op эффекта: `game.py -> resolve_card_effects()` (и/или `resolve_effect_list()`)

Автосейв хранится на диске в `./saves/<sid>.json` (sid лежит в localStorage браузера).
